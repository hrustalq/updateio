# API Сервис

## Обзор
API сервис является центральным бэкенд-компонентом системы UpdateIO, отвечающим за управление обновлениями игр, пользовательскими подписками и координацию взаимодействия между различными сервисами.

## Технический Стек
- **Фреймворк**: NestJS
- **База данных**: PostgreSQL (через Prisma ORM)
- **Кэширование**: Redis
- **Очередь сообщений**: Kafka
- **Мониторинг**:
  - Grafana для визуализации
  - Loki для агрегации логов
  - Promtail для отправки логов

## Основные Обязанности

### Управление Играми
- Поддержка метаданных игр и связей
- Отслеживание версий игр и истории обновлений
- Сопоставление названий игр с конкретными ID
- Управление информацией о провайдерах игр

### Обработка Обновлений
- Обработка входящих обновлений игр от Discord бота
- Обогащение информации об обновлениях метаданными игр
- Распространение обновлений соответствующим потребителям
- Отслеживание статуса и истории обновлений

### Управление Пользователями
- Обработка аутентификации и авторизации
- Управление подписками и настройками пользователей
- Отслеживание настроек уведомлений
- Обработка пользовательских конфигураций обновлений

### Система Подписок
- Управление уровнями подписок и функциями
- Обработка жизненного цикла подписок
- Обработка событий подписок
- Отслеживание использования и лимитов подписок

### API Эндпоинты
- REST API эндпоинты для всех сервисов
- Обработка CRUD операций для всех сущностей
- Предоставление информации об обновлениях в реальном времени
- Обработка вебхуков

## Точки Интеграции

### Входящие Интеграции
- Discord бот (обновления игр)
- Админ панель (конфигурация системы)
- Telegram бот (взаимодействия пользователей)
- Telegram мини-приложение (пользовательские настройки)

### Исходящие Интеграции
- Очереди сообщений для распространения обновлений
- Уведомления через вебхуки
- Обновления статуса в реальном времени
- Системы мониторинга и логирования

## Модели Данных
- Пользователь (User)
- Подписка (Subscription)
- Игра (Game)
- Провайдер игры (GameProvider)
- Обновление (Update)
- Уведомление (Notification)
- Настройки обновлений (UpdateSettings)
- Команда обновления (UpdateCommand)
- Отчет (Report)

## Развертывание
- Контейнеризация через Docker
- Часть инфраструктуры Docker Compose
- Масштабируемость на несколько экземпляров
- Stateless дизайн для горизонтального масштабирования 